<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0,user-scalable=0"
    />

    <style>
      html,
      body {
        font-family: 'Trebuchet MS', Roboto, Ubuntu, sans-serif;
        background: #131722;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .sma-legend {
        width: 96px;
        height: 70px;
        position: absolute;
        padding: 8px;
        font-size: 14px;
        background-color: rgba(255, 255, 255, 0.23);
        text-align: left;
        z-index: 1000;
        pointer-events: none;
      }
    </style>
    <script src="https://unpkg.com/lightweight-charts@3.4.0/dist/lightweight-charts.standalone.production.js"></script>
  </head>

  <body></body>
  <!-- <script>
    document.body.style.position = 'relative';

    var container = document.createElement('div');
    document.body.appendChild(container);

    var width = 350;
    var height = 200;

    var chart = LightweightCharts.createChart(container, {
      width: width,
      height: height,
      crosshair: {
        mode: LightweightCharts.CrosshairMode.Normal,
      },
      layout: {
        backgroundColor: '#131722',
        textColor: '#d1d4dc',
      },
      grid: {
        vertLines: {
          color: '#334158',
        },
        horzLines: {
          color: '#334158',
        },
      },
      priceScale: {
        borderColor: '#485c7b',
      },
      timeScale: {
        borderColor: '#485c7b',
      },
    });

    var candleSeries = chart.addCandlestickSeries();
    var data = generateBarsData();
    candleSeries.setData(data);

    var smaData = calculateSMA(data, 10);
    var smaLine = chart.addLineSeries({
      color: 'rgba(4, 111, 232, 1)',
      lineWidth: 2,
    });
    smaLine.setData(smaData);
    //ma30
    var smaData30 = calculateSMA(data, 30);
    var smaLine30 = chart.addLineSeries({
      color: '#FFC619',
      lineWidth: 2,
    });
    smaLine30.setData(smaData30);

    // var legend = document.createElement('div');
    // legend.className = 'sma-legend';
    // container.appendChild(legend);
    // legend.style.display = 'block';
    // legend.style.left = 3 + 'px';
    // legend.style.top = 3 + 'px';

    // function setLegendText(priceValue) {
    //   let val = 'âˆ…';
    //   if (priceValue !== undefined) {
    //     val = (Math.round(priceValue * 100) / 100).toFixed(2);
    //   }
    //   legend.innerHTML =
    //     'MA10 <span style="color:rgba(4, 111, 232, 1)">' + val + '</span>';
    // }

    // setLegendText(smaData[smaData.length - 1].value);

    // chart.subscribeCrosshairMove(param => {
    //   setLegendText(param.seriesPrices.get(smaLine));
    // });

    function calculateSMA(data, count) {
      var avg = function (data) {
        var sum = 0;
        for (var i = 0; i < data.length; i++) {
          sum += data[i].close;
        }
        return sum / data.length;
      };
      var result = [];
      for (var i = count - 1, len = data.length; i < len; i++) {
        var val = avg(data.slice(i - count + 1, i));
        result.push({time: data[i].time, value: val});
      }
      return result;
    }

    function generateBarsData(period) {
      var res = [];
      var controlPoints = generateControlPoints(res, period);
      for (var i = 0; i < controlPoints.length - 1; i++) {
        var left = controlPoints[i];
        var right = controlPoints[i + 1];
        fillBarsSegment(left, right, res);
      }
      return res;
    }

    function fillBarsSegment(left, right, points) {
      var deltaY = right.price - left.price;
      var deltaX = right.index - left.index;
      var angle = deltaY / deltaX;
      for (var i = left.index; i <= right.index; i++) {
        var basePrice = left.price + (i - left.index) * angle;
        var openNoise = 0.1 - Math.random() * 0.2 + 1;
        var closeNoise = 0.1 - Math.random() * 0.2 + 1;
        var open = basePrice * openNoise;
        var close = basePrice * closeNoise;
        var high = Math.max(basePrice * (1 + Math.random() * 0.2), open, close);
        var low = Math.min(basePrice * (1 - Math.random() * 0.2), open, close);
        points[i].open = open;
        points[i].high = high;
        points[i].low = low;
        points[i].close = close;
      }
    }

    function generateControlPoints(res, period, dataMultiplier) {
      var time =
        period !== undefined ? period.timeFrom : {day: 1, month: 1, year: 2018};
      var timeTo =
        period !== undefined ? period.timeTo : {day: 1, month: 1, year: 2019};
      var days = getDiffDays(time, timeTo);
      dataMultiplier = dataMultiplier || 1;
      var controlPoints = [];
      controlPoints.push({
        index: 0,
        price: getRandomPrice() * dataMultiplier,
      });
      for (var i = 0; i < days; i++) {
        if (i > 0 && i < days - 1 && Math.random() < 0.05) {
          controlPoints.push({
            index: i,
            price: getRandomPrice() * dataMultiplier,
          });
        }
        res.push({time: time});
        time = nextBusinessDay(time);
      }
      controlPoints.push({
        index: res.length - 1,
        price: getRandomPrice() * dataMultiplier,
      });
      return controlPoints;
    }

    function getDiffDays(dateFrom, dateTo) {
      var df = convertBusinessDayToUTCTimestamp(dateFrom);
      var dt = convertBusinessDayToUTCTimestamp(dateTo);
      var diffTime = Math.abs(dt.getTime() - df.getTime());
      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    }

    function convertBusinessDayToUTCTimestamp(date) {
      return new Date(
        Date.UTC(date.year, date.month - 1, date.day, 0, 0, 0, 0),
      );
    }

    function nextBusinessDay(time) {
      var d = convertBusinessDayToUTCTimestamp({
        year: time.year,
        month: time.month,
        day: time.day + 1,
      });
      return {
        year: d.getUTCFullYear(),
        month: d.getUTCMonth() + 1,
        day: d.getUTCDate(),
      };
    }

    function getRandomPrice() {
      return 10 + Math.round(Math.random() * 10000) / 100;
    }
  </script> -->
</html>
